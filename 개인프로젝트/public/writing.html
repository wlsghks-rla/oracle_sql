<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>글작성</title>
    <link rel="stylesheet" href="writing.css" />
  </head>
  <body>
    <div id="container">
      <header>
        <ul>
          <li id="welcome"></li>
          <li>
            <a href="index.html">로그아웃</a>
          </li>
        </ul>
        <h3>고양이를 위한 자유게시판</h3>
      </header>
      <form name="write" action="#" method="post">
        <fieldset>
          <legend></legend>
          <ul>
            <li>
              <label for="title">제 목</label>
              <input
                type="text"
                id="title"
                name="title"
                placeholder="제목을 작성하세요"
                required
              />
            </li>
            <li id="userid">
              <label for="author">작성자</label>
            </li>
            <li id="yearday">
              <label for="date">작성일</label>
            </li>
            <li>
              <label for="categories">분 류</label>
              <select name="categories" id="categories" required>
                <option value="total">전체</option>
                <option value="food">사료후기</option>
                <option value="food">행동/성격</option>
                <option value="protect">입양/보호</option>
                <option value="ilsang">일상공유</option>
                <option value="hoogi">용품후기</option>
              </select>
            </li>
            <li>
              <span>품종</span>
              <select name="variety" id="variety" required>
                <option value="total">전체</option>
                <option value="russian">러시안블루</option>
                <option value="etc">기타</option>
              </select>
            </li>
            <li>
              <span>성별</span>
              <select name="gender" id="gender" required>
                <option value="total">전체</option>
                <option value="man">남자</option>
                <option value="girl">여자</option>
              </select>
            </li>
            <li>
              <span>나이</span>
              <select name="age" id="age" required>
                <option value="total">전체</option>
                <option value="one">1</option>
                <option value="two">2</option>
                <option value="three">3</option>
                <option value="four">4</option>
                <option value="five">5</option>
                <option value="six">6</option>
                <option value="seven">7</option>
                <option value="eight">8</option>
                <option value="nine">9</option>
                <option value="ten">10</option>
                <option value="eleven">11</option>
                <option value="tweleve">12</option>
                <option value="thirteen">13</option>
                <option value="fourteen">14</option>
                <option value="fifteen">15</option>
                <option value="etc">기타</option>
              </select>
            </li>
            <li>
              <label for="content" class="content">내용</label>
              <textarea cols="85" rows="30" id="content" name="content">
              </textarea>
            </li>
          </ul>
        </fieldset>
      </form>
      <section>
        <button type="button" onclick="success()">글작성</button>
        <button type="button" onclick="back()">취소</button>
      </section>
    </div>
  </body>
  <script>
    // 사용자 정보 불러오기
    let uid = localStorage.getItem("uid");
    console.log(uid);
    let txt = document.createTextNode(`${uid}님 환영합니다`);
    console.log(txt);

    document.querySelector("#welcome").appendChild(txt);

    // 작성자 자동 추가
    let input = document.createElement("input");
    input.value = uid;
    input.setAttribute("readonly", true);
    document.querySelector("#userid").appendChild(input);

    // 작성일 자동 추가
    let date = new Date();
    let year = date.getFullYear();
    let month = date.getMonth() + 1;
    let day = date.getDate();
    let today = `${year}-${month}-${day}`;
    console.log(today);

    let totoday = document.createElement("input");
    totoday.value = today;
    totoday.setAttribute("readonly", true);
    document.querySelector("#yearday").appendChild(totoday);
    // 취소 기능
    function back() {
      location.href = "freeboards.html";
    }

    // 글작성
    let categories = document.querySelector("#categories");
    let variety = document.querySelector("#variety");
    let gender = document.querySelector("#gender");
    let age = document.querySelector("#age");
    async function success() {
      console.log("successing");
      let response = await fetch("http://localhost:3000/write", {
        method: "post",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          title: document.querySelector("#title").value,
          author: uid,
          categories:
            document.querySelector("#categories").options[
              categories.selectedIndex
            ].text,
          variety:
            document.querySelector("#variety").options[variety.selectedIndex]
              .text,
          gender:
            document.querySelector("#gender").options[gender.selectedIndex]
              .text,
          age: document.querySelector("#age").options[age.selectedIndex].text,
          content: document.querySelector("#content").value,
        }),
      });
      let result = await response.json();
      console.log(result);
      if (result != null) {
        alert("글 작성완료!");
        result = true;
        if (result) {
          location.href = "freeboards.html";
        }
      }
    }
  </script>
</html>
